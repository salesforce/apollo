syntax = "proto3";

option java_multiple_files = true;
option java_package = "com.salesfoce.apollo.gorgoneion.proto";
option java_outer_classname = "GorgoneionProto";
option objc_class_prefix = "Gp";

import "google/protobuf/any.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/duration.proto";

import "stereotomy.proto";
import "util.proto";

package gorgoneion;


service Admissions {
    rpc apply (Registration) returns (SignedNonce) {}
    rpc register(SignedAttestation) returns (stereotomy.Validations) {}
}

service Replication {
    rpc gossip (Gossip) returns (Update) {}
    rpc update (Update) returns (google.protobuf.Empty) {}
}

message Registration {
    utils.Digeste context = 1;
    stereotomy.Ident identity = 2;
    stereotomy.KERL_ kerl = 3;
}

message Nonce {
    stereotomy.Ident member = 1;
    stereotomy.EventCoords issuer = 2;
    utils.Digeste noise = 3;
    google.protobuf.Timestamp timestamp = 4;
    google.protobuf.Duration duration = 5;
}

message SignedNonce {
    Nonce nonce = 1;
    utils.Sig signature = 2;
}

message Attestation {
    stereotomy.Ident member = 1;
    utils.Sig nonce = 2;
    google.protobuf.Timestamp timestamp = 3;
    google.protobuf.Any attestation = 4;
}

message SignedAttestation {
    utils.Digeste context = 1;
    Attestation attestation = 2;
    utils.Sig signature = 3;
}

message Gossip {
    utils.Digeste context = 1;
    Have have = 2;
}

message Update {
    utils.Digeste context = 1;
    repeated Pending pending = 2;
    repeated SignedProposal proposals = 3;
    repeated SignedEndorsement endorsements = 4;
    repeated SignedDeny deny = 5;
    Have have = 6;
}

message Have {
    utils.Biff pending = 1;
    utils.Biff proposals = 2;
    utils.Biff endorsements = 3;
    utils.Biff denies = 4;
}

message Pending {
    stereotomy.KERL_ kerl = 1;
    SignedNonce pending = 2;
}

message Endorsement {
    utils.Digeste endorser = 1;
    SignedNonce nonce = 2;
    stereotomy.Validation_ validation = 3;
}

message SignedEndorsement {
    Endorsement endorsement = 1;
    utils.Sig signature = 2;
}

message Deny {
    utils.Digeste denier = 1;
    SignedNonce nonce = 2;
}

message SignedDeny {
    Deny denial = 1;
    utils.Sig signature = 2;
}

message Proposal {
    utils.Digeste proposer = 1;
    SignedNonce nonce = 2;
    SignedAttestation  attestation = 3;
}

message SignedProposal {
    Proposal proposal = 1;
    utils.Sig signature = 2;
}
