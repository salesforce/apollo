syntax = "proto3";

option java_multiple_files = true;
option java_package = "com.salesfoce.apollo.messaging.proto";
option java_outer_classname = "MessagingProto";
option objc_class_prefix = "Mp";
import "google/protobuf/any.proto";
import "google/protobuf/empty.proto";

package apollo;

service Messaging {
    rpc gossip (MessageBff) returns (Messages) {}
    rpc update (Push) returns (google.protobuf.Empty) {}
}

message MessageBff {
    bytes context = 1; 
    int32 ring = 3;
    bytes digests = 4;
}

message Push {
    bytes context = 1;
    int32 ring = 2;
    repeated  Message updates = 3;
}

message Message {
    bytes source = 1;
    int32 sequenceNumber = 2;
    int32 age = 3;
    int32 channel = 4;
    string signature = 5;
    bytes key = 6;
    google.protobuf.Any content = 7;
}

message ByteMessage {
    bytes contents = 1;
}

message Messages {
    bytes bff = 1;
    repeated  Message updates = 2;
}