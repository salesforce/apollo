syntax = "proto3";

option java_multiple_files = true;
option java_package = "com.salesfoce.apollo.stereotomy.event.proto";
option java_outer_classname = "StereotomyProto";
option objc_class_prefix = "Stereo";
import "google/protobuf/any.proto";

package stereotomy;

message RotationEvent {
    Header header = 1;
    Establishment establishment = 2;
    repeated bytes removedWitnesses = 3;
    repeated bytes  addedWitnesses = 4;
    repeated Seal seals = 5;
    EventCoordinates delegatingEvent = 6;
}

message InceptionEvent {
    Header header = 1;
    Establishment establishment = 2;
    IdentifierSpec inceptionStatement = 3;
    repeated bytes witnesses = 4;
    repeated string configurationTraits = 5;
    EventCoordinates delegatingEvent = 6;
}

message InteractionEvent {
    Header header = 1;
    repeated Seal seals = 5;
}

message AttachmentEvent {
    EventCoordinates coordinates = 1;
    Signatures authentication = 2;
    Signatures endorsements = 3; 
    repeated Receipt receipts = 4;
}

message Establishment {
    SigningThreshold signingThreshold = 1;
    repeated bytes keys = 2;
    bytes nextKeyConfiguration = 3;
    int32 witnessThreshold = 4;
}

message Header {
    int64 sequenceNumber = 1;
    bytes identifier = 2;
    bytes previousDigest = 3;
    Version version = 4;
    map<int32, bytes> authentication = 5;
    string format = 6; 
    map<int32, bytes> endorsements = 7;
    EventCoordinates previous = 8;
    repeated Receipt receipts = 9;
    bytes configuration = 10;
}

message Seal {
    oneof type {
        bytes digest = 1;
        EventCoordinates coordinates = 2;
    }
}

message Receipt {
    EventCoordinates coordinates = 1;
    map<int32, bytes> signatures = 2;
}

message Signatures {
    map<int32, bytes> signatures = 1;
}

message Weight {
    int32 denominator = 1;
    int32 numerator = 2;
}

message Weights {
    repeated Weight weights = 1;
}

message SigningThreshold {
    int32 threshold = 1;
    repeated Weights weights = 2;
}

message Version {
    int32 major = 1;
    int32 minor = 2;
}

message EventCoordinates {
    int64 sequenceNumber = 1;
    bytes identifier = 2;
    bytes digest = 3;
}

message StoredKeyState {
    bytes identifier = 1;
    bytes digest = 2;
    EventCoordinates coordinates = 3;
    EventCoordinates lastEvent = 4;
    EventCoordinates lastEstablishmentEvent = 5;
    bytes delegatingIdentifier = 6;
    repeated bytes keys = 7;
    bytes nextKeyConfigurationDigest = 8;
    repeated string configurationTraits = 9;
    SigningThreshold signingThreshold = 10;
    repeated bytes witnesses = 11;
    int32 witnessThreshold = 12;
}

message IdentifierSpec {
    Version version = 1;
    bytes identifier = 2;
    int64 sequenceNumber = 3;
    string eventType = 4;
    SigningThreshold signingThreshold = 5;
    repeated bytes keys = 6;
    bytes nextKeysDigest = 7;
    int32 witnessThreshold = 8;
    repeated bytes witnesses = 9;
    repeated string configuration = 10;
}

message InteractionSpec {
    Version version = 1;
    bytes identifier = 2;
    int64 sequenceNumber = 3;
    string eventType = 4;
    bytes priorEventDigest = 5;
    repeated Seal anchors = 6;
}

message RotationSpec {
    Version version = 1;
    bytes identifier = 2;
    int64 sequenceNumber = 3;
    string eventType = 4;
    bytes priorEventDigest = 5;
    repeated bytes keys = 6;
    SigningThreshold signingThreshold = 7;
    bytes nextKeysDigest = 8;
    int32 witnessThreshold = 9;
    repeated bytes witnessesRemoved = 10;
    repeated bytes witnessesAdded = 11;
    repeated Seal achnors = 12;
}